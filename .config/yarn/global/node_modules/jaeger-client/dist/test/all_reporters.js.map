{"version":3,"sources":["../../test/all_reporters.js"],"names":["describe","reporters","beforeEach","loggingReporter","inMemoryReporter","setProcess","noopReporter","sender","_process","remoteReporter","it","compositeReporter","equal","name","closeOptions","callback","spy","predicate","calledOnce","forEach","reporter","close","o","isOk","logger","spanMock","context","toString","report","_infoMsgs","mockReporter"],"mappings":"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","file":"all_reporters.js","sourcesContent":["// Copyright (c) 2016 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n// in compliance with the License. You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software distributed under the License\n// is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n// or implied. See the License for the specific language governing permissions and limitations under\n// the License.\n\nimport { assert } from 'chai';\nimport CompositeReporter from '../src/reporters/composite_reporter';\nimport InMemoryReporter from '../src/reporters/in_memory_reporter';\nimport NoopReporter from '../src/reporters/noop_reporter';\nimport RemoteReporter from '../src/reporters/remote_reporter';\nimport UDPSender from '../src/reporters/udp_sender';\nimport MockLogger from './lib/mock_logger';\nimport LoggingReporter from '../src/reporters/logging_reporter';\nimport sinon from 'sinon';\n\ndescribe('All Reporters should', () => {\n  let reporters;\n  beforeEach(() => {\n    let loggingReporter = new LoggingReporter();\n    let inMemoryReporter = new InMemoryReporter();\n    inMemoryReporter.setProcess('service-name', []);\n    let noopReporter = new NoopReporter();\n    let sender = new UDPSender();\n    sender.setProcess(inMemoryReporter._process);\n    let remoteReporter = new RemoteReporter(sender);\n    reporters = [loggingReporter, inMemoryReporter, noopReporter, remoteReporter];\n  });\n\n  it('have proper names', () => {\n    let loggingReporter = new LoggingReporter();\n    let inMemoryReporter = new InMemoryReporter();\n    inMemoryReporter.setProcess('service-name', []);\n    let noopReporter = new NoopReporter();\n    let remoteReporter = new RemoteReporter(new UDPSender());\n    let compositeReporter = new CompositeReporter();\n\n    assert.equal(loggingReporter.name(), 'LoggingReporter');\n    assert.equal(inMemoryReporter.name(), 'InMemoryReporter');\n    assert.equal(noopReporter.name(), 'NoopReporter');\n    assert.equal(remoteReporter.name(), 'RemoteReporter');\n    assert.equal(compositeReporter.name(), 'CompositeReporter');\n  });\n\n  let closeOptions = [\n    {\n      callback: sinon.spy(),\n      predicate: spy => {\n        return spy.calledOnce === true;\n      },\n    },\n    {\n      callback: null,\n      predicate: spy => {\n        return true;\n      },\n    },\n  ];\n\n  closeOptions.forEach(o => {\n    it('calls to close execute callback correctly', () => {\n      let reporter = new CompositeReporter(reporters);\n\n      reporter.close(o.callback);\n\n      assert.isOk(o.predicate(o.callback));\n    });\n  });\n\n  describe('Logging reporter', () => {\n    it('logs span as context().toString()', () => {\n      let logger = new MockLogger();\n      let reporter = new LoggingReporter(logger);\n      let spanMock = {\n        context: function context() {\n          return {\n            toString: function toString() {\n              return 'span-as-string';\n            },\n          };\n        },\n      };\n\n      reporter.report(spanMock);\n\n      assert.equal(logger._infoMsgs[0], 'Reporting span span-as-string');\n    });\n  });\n\n  describe('Composite reporter', () => {\n    it('should report spans', () => {\n      let mockReporter = {\n        report: sinon.spy(),\n      };\n      let reporter = new CompositeReporter([mockReporter]);\n      reporter.report();\n\n      assert.isOk(mockReporter.report.calledOnce);\n    });\n  });\n});\n"]}